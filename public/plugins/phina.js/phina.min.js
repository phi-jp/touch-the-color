!function(){Object.defineProperty(Object.prototype,"property",{value:function(t,i){Object.defineProperty(this,t,{value:i,enumerable:!0,writable:!0})}}),Object.defineProperty(Object.prototype,"method",{value:function(t,i){Object.defineProperty(this,t,{value:i,enumerable:!1,writable:!0})}}),Object.prototype.method("setter",function(t,i){Object.defineProperty(this,t,{set:i,enumerable:!1,configurable:!0})}),Object.prototype.method("getter",function(t,i){Object.defineProperty(this,t,{get:i,enumerable:!1,configurable:!0})}),Object.prototype.method("accessor",function(t,i){Object.defineProperty(this,t,{set:i.set,get:i.get,enumerable:!1,configurable:!0})}),Object.prototype.method("forIn",function(t,i){return i=i||this,Object.keys(this).forEach(function(n,e){var s=this[n];t.call(i,n,s,e)},this),this}),Object.prototype.method("$has",function(t){return this.hasOwnProperty(t)}),Object.prototype.method("$extend",function(){return Array.prototype.forEach.call(arguments,function(t){for(var i in t)this[i]=t[i]},this),this}),Object.prototype.method("$safe",function(t){return Array.prototype.forEach.call(arguments,function(t){for(var i in t)void 0===this[i]&&(this[i]=t[i])},this),this}),Object.prototype.method("$strict",function(t){return Array.prototype.forEach.call(arguments,function(t){for(var i in t)console.assert(!this[i],"tm error: {0} is Already".format(i)),this[i]=t[i]},this),this}),Object.prototype.method("$pick",function(){var t={};return Array.prototype.forEach.call(arguments,function(i){i in this&&(t[i]=this[i])},this),t}),Object.prototype.method("$omit",function(){var t={};for(var i in this)-1==Array.prototype.indexOf.call(arguments,i)&&(t[i]=this[i]);return t}),Object.observe||Object.method("observe",function(t,i){var n=Object.keys(t);n.forEach(function(n){var e="__"+n,s=t[n];t[e]=s,t.accessor(n,{get:function(){return this[e]},set:function(t){this[e]=t,i()}})})}),Object.unobserve||Object.method("unobserve",function(t,i){console.assert(!1)})}(),function(){Number.prototype.method("times",function(t,i){i=i||this;for(var n=0;this>n;++n)t.call(i,n);return this})}(),function(){String.prototype.method("format",function(t){var i=void 0;if("object"==typeof t)i=function(i,n){return void 0===t[n]?"":t[n]};else{var n=arguments;i=function(t,i){return n[parseInt(i)]}}return this.replace(/\{(\w+)\}/g,i)})}(),function(){Array.prototype.accessor("first",{get:function(){return this[0]},set:function(t){this[0]=t}}),Array.prototype.accessor("last",{get:function(){return this[this.length-1]},set:function(t){this[this.length-1]=t}}),Array.prototype.method("equals",function(t){if(this.length!==t.length)return!1;for(var i=0,n=this.length;n>i;++i)if(this[i]!==t[i])return!1;return!0}),Array.prototype.method("deepEquals",function(t){if(this.length!==t.length)return!1;for(var i=0,n=this.length;n>i;++i){var e=this[i].deepEquals?this[i].deepEquals(t[i]):this[i]===t[i];if(e===!1)return!1}return!0}),Array.prototype.method("contains",function(t,i){return-1!=this.indexOf(t,i)}),Array.prototype.method("at",function(t){return t%=this.length,t+=this.length,t%=this.length,this[t]}),Array.prototype.method("find",function(t,i){var n=null;return this.some(function(e,s){return t.call(i,e,s,this)?(n=e,!0):void 0}),n}),Array.prototype.method("findIndex",function(t,i){var n=null;return this.some(function(e,s){return t.call(i,e,s,this)?(n=s,!0):void 0}),n}),Array.prototype.method("swap",function(t,i){var n=this[t];return this[t]=this[i],this[i]=n,this}),Array.prototype.method("erase",function(t){var i=this.indexOf(t);return i>=0&&this.splice(i,1),this}),Array.prototype.method("eraseAll",function(t){for(var i=0,n=this.length;n>i;++i)this[i]==t&&this.splice(i--,1);return this}),Array.prototype.method("eraseIf",function(t){for(var i=0,n=this.length;n>i;++i)if(t(this[i],i,this)){this.splice(i,1);break}return this}),Array.prototype.method("eraseIfAll",function(t){for(var i=0,n=this.length;n>i;++i)t(this[i],i,this)&&(this.splice(i--,1),n--);return this}),Array.prototype.method("random",function(t,i){return t=t||0,i=i||this.length-1,this[Math.rand(t,i)]}),Array.prototype.method("pickup",function(t,i){return t=t||0,i=i||this.length-1,this[Math.rand(t,i)]}),Array.prototype.method("lot",function(t,i){return t=t||0,i=i||this.length-1,this[Math.rand(t,i)]}),Array.prototype.method("uniq",function(t){return this.filter(function(t,i,n){return n.indexOf(t)===i})}),Array.prototype.method("flatten",function(t){var i=null;if(t){i=this;for(var n=0;t>n;++n)i=Array.prototype.concat.apply([],i)}else i=this.reduce(function(t,i){return t.concat(Array.isArray(i)?i.flatten():i)},[]);return i}),Array.prototype.method("clone",function(t){if(t===!0){for(var i=Array(this.length),n=0,e=this.length;e>n;++n)i[n]=this[n].clone?this[n].clone(t):this[n];return i}return Array.prototype.slice.apply(this)}),Array.prototype.method("clear",function(){return this.length=0,this}),Array.prototype.method("fill",function(t,i,n){i=i||0,n=n||this.length;for(var e=i;n>e;++e)this[e]=t;return this}),Array.prototype.method("range",function(t,i,n){if(this.clear(),1==arguments.length)for(var e=0;t>e;++e)this[e]=e;else if(i>t){n=n||1;for(var e=t,s=0;i>e;e+=n,++s)this[s]=e}else{n=n||-1;for(var e=t,s=0;e>i;e+=n,++s)this[s]=e}return this}),Array.prototype.method("shuffle",function(){for(var t=0,i=this.length;i>t;++t){var n=Math.rand(0,i-1);t!=n&&this.swap(t,n)}return this}),Array.prototype.method("sum",function(){for(var t=0,i=0,n=this.length;n>i;++i)t+=this[i];return t}),Array.prototype.method("average",function(){for(var t=0,i=this.length,n=0;i>n;++n)t+=this[n];return t/i}),Array.prototype.method("each",function(){return this.forEach.apply(this,arguments),this}),Array.prototype.method("toULElement",function(){}),Array.prototype.method("toOLElement",function(){}),Array.method("range",function(t,i,n){return Array.prototype.range.apply([],arguments)}),Array.method("of",function(){return Array.prototype.slice.call(arguments)}),Array.method("from",function(t,i,n){return Object(t).length?Array.prototype.map.call(t,"function"==typeof i?i:function(t){return t},n):[]})}(),function(){Math.DEG_TO_RAD=Math.PI/180,Math.RAD_TO_DEG=180/Math.PI,Math.degToRad=function(t){return t*Math.DEG_TO_RAD},Math.radToDeg=function(t){return t*Math.RAD_TO_DEG},Math.method("clamp",function(t,i,n){return i>t?i:t>n?n:t}),Math.method("inside",function(t,i,n){return t>=i&&n>=t}),Math.method("rand",function(t,i){return window.Math.floor(Math.random()*(i-t+1))+t}),Math.method("randf",function(t,i){return window.Math.random()*(i-t)+t})}();var phina=phina||{};!function(){phina.method("isNode",function(){return"undefined"!=typeof module}),phina.method("namespace",function(t){t.call(this)});var t=phina.isNode()?global:window;phina.accessor("global",{get:function(){return t}}),phina.isNode()&&(module.exports=phina),t.phina=phina}(this),phina.namespace(function(){phina.method("createClass",function(t){var i=function(){var t=new i.prototype._creator;return i.prototype.init.apply(t,arguments),t};return t.superClass&&(i.prototype=Object.create(t.superClass.prototype),t.init.owner=i,i.prototype.superInit=function(){var t=this.superInit.caller,i=t.owner,n=i.prototype.superClass,e=n.prototype.init;e.apply(this,arguments)},i.prototype.constructor=i),i.prototype.$extend(t),i.prototype.selfClass=i,t._accessor&&(i.prototype=Object.create(i.prototype,t._accessor)),i.prototype._creator=function(){return this},i.prototype._creator.prototype=i.prototype,t._static&&i.$extend(t._static),i});phina.method("using",function(t){if(!t)return phina.global;var i=t.split(/[,.\/ ]|::/),n=phina.global;return i.forEach(function(t){n=n[t]||(n[t]={})}),n}),phina.method("register",function(t,i){var n=t.split(/[,.\/ ]|::/),e=n.last,s=t.substring(0,t.lastIndexOf(".")),h=phina.using(s);return h[e]=i,i}),phina.method("define",function(t,i){i.superClass&&(i.superClass="string"==typeof i.superClass?phina.using(i.superClass):i.superClass);var n=phina.createClass(i);return n.prototype.accessor("className",{get:function(){return t}}),phina.register(t,n),n}),phina.method("globalize",function(){phina.forIn(function(t,i){i.forIn(function(t,i){phina.global[t]=i})})})}),phina.namespace(function(){phina.define("phina.geom.Vector2",{init:function(t,i){this.x=t,this.y=i},clone:function(){return phina.geom.Vector2(this.x,this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},set:function(t,i){this.x=t,this.y=i},add:function(t){this.x+=t.x,this.y+=t.y},sub:function(t){this.x-=t.x,this.y-=t.y},mul:function(t){this.x*=t,this.y*=t},div:function(t){n=n||.01,this.x/=n,this.y/=n},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return this.x*this.x+this.y*this.y},distance:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},distanceSquared:function(t){return Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2)},random:function(t,i){var n=Math.randf(t||0,i||360),e=n*Math.DEG_TO_RAD;return this.x=Math.cos(e),this.y=Math.sin(e),this},_accessor:{},_defined:function(){}})}),phina.namespace(function(){phina.define("phina.geom.Matrix33",{init:function(){arguments.length>=9?this.set.apply(this,arguments):this.identity()},set:function(t,i,n,e,s,h,r,a,o){return this.m00=t,this.m01=i,this.m02=n,this.m10=e,this.m11=s,this.m12=h,this.m20=r,this.m21=a,this.m22=o,this},identity:function(){return this.m00=1,this.m01=0,this.m02=0,this.m10=0,this.m11=1,this.m12=0,this.m20=0,this.m21=0,this.m22=1,this},clone:function(){return phina.geom.Matrix33(this.m00,this.m01,this.m02,this.m10,this.m11,this.m12,this.m20,this.m21,this.m22)},determinant:function(){var t=this.m00,i=this.m01,n=this.m02,e=this.m10,s=this.m11,h=this.m12,r=this.m20,a=this.m21,o=this.m22;return t*s*o+e*a*n+i*h*r-n*s*r-i*e*o-h*a*t},transpose:function(){var t=function(t,i){var n=this[t];this[t]=this[i],this[i]=n}.bind(this);return t("m01","m10"),t("m02","m20"),t("m12","m21"),this},invert:function(){var t=this.m00,i=this.m01,n=this.m02,e=this.m10,s=this.m11,h=this.m12,r=this.m20,a=this.m21,o=this.m22,u=this.determinant();return this.m00=(s*o-h*a)/u,this.m01=(e*o-h*r)/u*-1,this.m02=(e*a-s*r)/u,this.m10=(i*o-n*a)/u*-1,this.m11=(t*o-n*r)/u,this.m12=(t*a-i*r)/u*-1,this.m20=(i*h-n*s)/u,this.m21=(t*h-n*e)/u*-1,this.m22=(t*s-i*e)/u,this.transpose(),this},multiply:function(t){var i=(this.m,t.m,this.m00),n=this.m01,e=this.m02,s=this.m10,h=this.m11,r=this.m12,a=this.m20,o=this.m21,u=this.m22,c=t.m00,p=t.m01,l=t.m02,f=t.m10,d=t.m11,m=t.m12,g=t.m20,v=t.m21,y=t.m22;return this.m00=i*c+n*f+e*g,this.m01=i*p+n*d+e*v,this.m02=i*l+n*m+e*y,this.m10=s*c+h*f+r*g,this.m11=s*p+h*d+r*v,this.m12=s*l+h*m+r*y,this.m20=a*c+o*f+u*g,this.m21=a*p+o*d+u*v,this.m22=a*l+o*m+u*y,this},multiplyVector2:function(t){var i=this.m00*t.x+this.m01*t.y+this.m02,n=this.m10*t.x+this.m11*t.y+this.m12;return phina.geom.Vector2(i,n)},getRow:function(){},getCol:function(){},toString:function(){return"|{m00}, {m01}, {m02}|\n|{m10}, {m11}, {m12}|\n|{m20}, {m21}, {m22}|".format(this)},_accessor:{x:{get:function(){return this._x},set:function(t){this._x=t}}}}),phina.geom.Matrix33.IDENTITY=phina.geom.Matrix33().identity()}),phina.namespace(function(){phina.define("phina.util.EventDispatcher",{init:function(){this._listeners={}},on:function(t,i){return void 0===this._listeners[t]&&(this._listeners[t]=[]),this._listeners[t].push(i),this},off:function(t,i){},fire:function(t){t.target=this;var i="on"+t.type;this[i]&&this[i](t);var n=this._listeners[t.type];if(n)for(var e=n.clone(),s=0,h=e.length;h>s;++s)e[s].call(this,t);return this},flare:function(t,i){var n={type:t};return i&&i.forIn(function(t,i){n[t]=i}),this.fire(n),this},one:function(t,i){},has:function(t){return void 0!==this._listeners[t]||this["on"+t]?!0:!1},clear:function(t){var i="on"+t;return this[i]&&delete this[i],this._listeners[t]=[],this}})}),function(){phina.define("phina.util.Tween",{superClass:"phina.util.EventDispatcher",init:function(t){this.superInit(),this.time=0},fromTo:function(t,i,n,e,s){this.target=t,this.beginProps=i,this.finishProps=n,this.duration=e||1e3,this.easing=s,this.changeProps={};for(var h in i)this.changeProps[h]=n[h]-i[h];return this},to:function(t,i,n,e){var s={};for(var h in i)s[h]=t[h];return this.fromTo(t,s,i,n,e),this},from:function(t,i,n,e){var s={};for(var h in i)s[h]=t[h],t[h]=i[h];return this.fromTo(t,i,s,n,e),this},by:function(t,i,n,e){var s={},h={};for(var r in i)s[r]=t[r],h[r]=t[r]+i[r];return this.fromTo(t,s,h,n,e),this},yoyo:function(){var t=this.beginProps;return this.beginProps=this.finishProps,this.finishProps=t,this.changeProps.forIn(function(t,i,n){this.changeProps[t]=-i,this.target[t]=this.beginProps[t]},this),this},gain:function(t){this.seek(this.time+t)},forward:function(t){this.seek(this.time+t)},backward:function(t){this.seek(this.time-t)},seek:function(t){return this.time=Math.clamp(t,0,this.duration),this.beginProps.forIn(function(t,i){var n=this.easing(this.time,i,this.changeProps[t],this.duration);this.target[t]=n},this),this},_accessor:{easing:{get:function(){return this._easing},set:function(t){this._easing=phina.util.Tween.EASING[t]||phina.util.Tween.EASING["default"]}}}}),phina.util.Tween.EASING={"default":function(t,i,n,e){return n*t/e+i},linear:function(t,i,n,e){return n*t/e+i},swing:function(t,i,n,e){return-n*(t/=e)*(t-2)+i},easeInQuad:function(t,i,n,e){return n*(t/=e)*t+i},easeOutQuad:function(t,i,n,e){return-n*(t/=e)*(t-2)+i},easeInOutQuad:function(t,i,n,e){return(t/=e/2)<1?n/2*t*t+i:-n/2*(--t*(t-2)-1)+i},easeInCubic:function(t,i,n,e){return n*(t/=e)*t*t+i},easeOutCubic:function(t,i,n,e){return n*((t=t/e-1)*t*t+1)+i},easeInOutCubic:function(t,i,n,e){return(t/=e/2)<1?n/2*t*t*t+i:n/2*((t-=2)*t*t+2)+i},easeOutInCubic:function(t,i,n,e){return e/2>t?tm.anim.easing.easeOutCubic(2*t,i,n/2,e):tm.anim.easing.easeInCubic(2*t-e,i+n/2,n/2,e)},easeInQuart:function(t,i,n,e){return n*(t/=e)*t*t*t+i},easeOutQuart:function(t,i,n,e){return-n*((t=t/e-1)*t*t*t-1)+i},easeInOutQuart:function(t,i,n,e){return(t/=e/2)<1?n/2*t*t*t*t+i:-n/2*((t-=2)*t*t*t-2)+i},easeOutInQuart:function(t,i,n,e){return e/2>t?tm.anim.easing.easeOutQuart(2*t,i,n/2,e):tm.anim.easing.easeInQuart(2*t-e,i+n/2,n/2,e)},easeInQuint:function(t,i,n,e){return n*(t/=e)*t*t*t*t+i},easeOutQuint:function(t,i,n,e){return n*((t=t/e-1)*t*t*t*t+1)+i},easeInOutQuint:function(t,i,n,e){return(t/=e/2)<1?n/2*t*t*t*t*t+i:n/2*((t-=2)*t*t*t*t+2)+i},easeOutInQuint:function(t,i,n,e){return e/2>t?tm.anim.easing.easeOutQuint(2*t,i,n/2,e):tm.anim.easing.easeInQuint(2*t-e,i+n/2,n/2,e)},easeInSine:function(t,i,n,e){return-n*Math.cos(t/e*(Math.PI/2))+n+i},easeOutSine:function(t,i,n,e){return n*Math.sin(t/e*(Math.PI/2))+i},easeInOutSine:function(t,i,n,e){return-n/2*(Math.cos(Math.PI*t/e)-1)+i},easeOutInSine:function(t,i,n,e){return e/2>t?tm.anim.easing.easeOutSine(2*t,i,n/2,e):tm.anim.easing.easeInSine(2*t-e,i+n/2,n/2,e)},easeInExpo:function(t,i,n,e){return 0==t?i:n*Math.pow(2,10*(t/e-1))+i-.001*n},easeOutExpo:function(t,i,n,e){return t==e?i+n:1.001*n*(-Math.pow(2,-10*t/e)+1)+i},easeInOutExpo:function(t,i,n,e){return 0==t?i:t==e?i+n:(t/=e/2)<1?n/2*Math.pow(2,10*(t-1))+i-5e-4*n:n/2*1.0005*(-Math.pow(2,-10*--t)+2)+i},easeOutInExpo:function(t,i,n,e){return e/2>t?tm.anim.easing.easeOutExpo(2*t,i,n/2,e):tm.anim.easing.easeInExpo(2*t-e,i+n/2,n/2,e)},easeInCirc:function(t,i,n,e){return-n*(Math.sqrt(1-(t/=e)*t)-1)+i},easeOutCirc:function(t,i,n,e){return n*Math.sqrt(1-(t=t/e-1)*t)+i},easeInOutCirc:function(t,i,n,e){return(t/=e/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+i:n/2*(Math.sqrt(1-(t-=2)*t)+1)+i},easeOutInCirc:function(t,i,n,e){return e/2>t?tm.anim.easing.easeOutCirc(2*t,i,n/2,e):tm.anim.easing.easeInCirc(2*t-e,i+n/2,n/2,e)},easeInElastic:function(t,i,n,e,s,h){var r;return 0==t?i:1==(t/=e)?i+n:(h||(h=.3*e),!s||s<Math.abs(n)?(s=n,r=h/4):r=h/(2*Math.PI)*Math.asin(n/s),-(s*Math.pow(2,10*(t-=1))*Math.sin(2*(t*e-r)*Math.PI/h))+i)},easeOutElastic:function(t,i,n,e,s,h){var r;return 0==t?i:1==(t/=e)?i+n:(h||(h=.3*e),!s||s<Math.abs(n)?(s=n,r=h/4):r=h/(2*Math.PI)*Math.asin(n/s),s*Math.pow(2,-10*t)*Math.sin(2*(t*e-r)*Math.PI/h)+n+i)},easeInOutElastic:function(t,i,n,e,s,h){var r;return 0==t?i:2==(t/=e/2)?i+n:(h||(h=.3*e*1.5),!s||s<Math.abs(n)?(s=n,r=h/4):r=h/(2*Math.PI)*Math.asin(n/s),1>t?-.5*s*Math.pow(2,10*(t-=1))*Math.sin(2*(t*e-r)*Math.PI/h)+i:s*Math.pow(2,-10*(t-=1))*Math.sin(2*(t*e-r)*Math.PI/h)*.5+n+i)},easeOutInElastic:function(t,i,n,e,s,h){return e/2>t?tm.anim.easing.easeOutElastic(2*t,i,n/2,e,s,h):tm.anim.easing.easeInElastic(2*t-e,i+n/2,n/2,e,s,h)},easeInBack:function(t,i,n,e,s){return void 0==s&&(s=1.70158),n*(t/=e)*t*((s+1)*t-s)+i},easeOutBack:function(t,i,n,e,s){return void 0==s&&(s=1.70158),n*((t=t/e-1)*t*((s+1)*t+s)+1)+i},easeInOutBack:function(t,i,n,e,s){return void 0==s&&(s=1.70158),(t/=e/2)<1?n/2*t*t*(((s*=1.525)+1)*t-s)+i:n/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+i},easeOutInBack:function(t,i,n,e,s){return e/2>t?tm.anim.easing.easeOutBack(2*t,i,n/2,e,s):tm.anim.easing.easeInBack(2*t-e,i+n/2,n/2,e,s)},easeInBounce:function(t,i,n,e){return n-tm.anim.easing.easeOutBounce(e-t,0,n,e)+i},easeOutBounce:function(t,i,n,e){return(t/=e)<1/2.75?7.5625*n*t*t+i:2/2.75>t?n*(7.5625*(t-=1.5/2.75)*t+.75)+i:2.5/2.75>t?n*(7.5625*(t-=2.25/2.75)*t+.9375)+i:n*(7.5625*(t-=2.625/2.75)*t+.984375)+i},easeInOutBounce:function(t,i,n,e){return e/2>t?.5*tm.anim.easing.easeInBounce(2*t,0,n,e)+i:.5*tm.anim.easing.easeOutBounce(2*t-e,0,n,e)+.5*n+i},easeOutInBounce:function(t,i,n,e){return e/2>t?tm.anim.easing.easeOutBounce(2*t,i,n/2,e):tm.anim.easing.easeInBounce(2*t-e,i+n/2,n/2,e)}}}(),function(){phina.define("phina.util.Ticker",{superClass:"phina.util.EventDispatcher",frame:null,deltaTime:null,elapsedTime:null,init:function(){this.superInit(),this.fps=30,this.frame=0,this.deltaTime=0,this.elapsedTime=0},tick:function(t){this.on("tick",t)},run:function(){var t=(new Date).getTime();this.deltaTime=t-this.currentTime,this.elapsedTime=t-this.startTime;var i=this.currentTime=t;this.flare("tick");var n=(new Date).getTime();this.frame+=1;var e=n-i,s=Math.max(this.frameTime-e,0);return s},start:function(){var t=this;return this.startTime=this.currentTime=(new Date).getTime(),function(){var i=t.run();setTimeout(arguments.callee,i)}(),this},resume:function(){},stop:function(){},rewind:function(){},_accessor:{fps:{get:function(){return this._fps},set:function(t){this._fps=t,this.frameTime=1e3/this._fps}}}})}(),function(){phina.define("phina.util.Grid",{width:640,columns:12,loop:!1,init:function(){if("object"==typeof arguments[0])var t=arguments[0],i=t.width||640,n=t.columns||12,e=t.loop||!1;else var i=arguments[0]||640,n=arguments[1]||12,e=arguments[2]||!1;this.width=i,this.columns=n,this.loop=e,this.unitWidth=this.width/this.columns},span:function(t){return this.loop&&(t+=this.columns,t%=this.columns),this.unitWidth*t},unit:function(){return this.unitWidth},center:function(){return this.width/2}})}(),phina.namespace(function(){phina.define("phina.util.ChangeDispatcher",{superClass:"phina.util.EventDispatcher",init:function(){this.superInit(),this._observe=!0},register:function(t,i){if(1===arguments.length){var n=arguments[0];n.forIn(function(t,i){this.register(t,i)},this)}else{var e="__"+t;this[e]=i,this.accessor(t,{get:function(){return this[e]},set:function(t){this[e]=t,this._observe&&this.flare("change")}})}return this},observe:function(){this._observe=!0},unobserve:function(){this._observe=!1}})}),function(){phina.define("phina.util.Flow",{superClass:"phina.util.EventDispatcher",init:function(t,i){if(this.superInit(),this.status="pending",this.resultValue=null,this._queue=[],this.func=t,i!==!0){var n=this,e=function(){n.resolve.apply(n,arguments),n.status="resolved"},s=function(){n.reject.apply(n,arguments),n.status="rejected"};this.func(e,s)}},resolve:function(t){this.resultValue=t,this._queue.each(function(t){t(this.resultValue)},this),this._queue.clear()},reject:function(){},then:function(t){if("resolved"===this.status){var i=t(this.resultValue);return phina.util.Flow.resolve(i)}var n=phina.util.Flow(function(t){t()},!0);return this._queue.push(function(i){var e=t(i);e instanceof phina.util.Flow?e.then(function(t){n.resolve(t)}):n.resolve(i)}),n},_static:{resolve:function(t){if(t instanceof phina.util.Flow)return t;var i=phina.util.Flow(function(i){i(t)});return i},all:function(t){return phina.util.Flow(function(i){var n=0,e=[];t.each(function(s){s.then(function(s){++n,e.push(s),n>=t.length&&i(e)})})})}}})}(),phina.namespace(function(){phina.define("phina.asset.Asset",{superClass:"phina.util.EventDispatcher",init:function(t){this.superInit(),this.loaded=!1},load:function(t){return this.src=t,phina.util.Flow(this._load.bind(this))},isLoaded:function(){return this.loaded},_load:function(t){var i=this;setTimeout(function(){i.loaded=!0,t()},100)}})}),phina.namespace(function(){phina.define("phina.asset.AssetManager",{_static:{assets:{image:{},sound:{}},get:function(t,i){return this.assets[t][i]},set:function(t,i,n){this.assets[t][i]=n},contains:function(t,i){}}})}),phina.namespace(function(){phina.define("phina.asset.Texture",{superClass:"phina.asset.Asset",init:function(){this.superInit()},_load:function(t){this.domElement=new Image,this.domElement.src=this.src;var i=this;this.domElement.onload=function(){i.loaded=!0,t(i)}}})}),function(){phina.define("phina.input.Input",{domElement:null,init:function(t){this.domElement=t||window.document,this.position=phina.geom.Vector2(0,0),this.deltaPosition=phina.geom.Vector2(0,0),this.prevPosition=phina.geom.Vector2(0,0),this._tempPosition=phina.geom.Vector2(0,0),this.flags=0},update:function(){this.last=this.now,this.now=this.flags,this.start=(this.now^this.last)&this.now,this.end=(this.now^this.last)&this.last,this.deltaPosition.x=this._tempPosition.x-this.position.x,this.deltaPosition.y=this._tempPosition.y-this.position.y,this._moveFlag=0===this.deltaPosition.x&&0===this.deltaPosition.y?!1:!0,this.prevPosition.set(this.position.x,this.position.y),this.position.set(this._tempPosition.x,this._tempPosition.y)},_start:function(t,i,n){n=void 0!==n?n:1,this._move(t,i),this.flags|=n;var t=this._tempPosition.x,i=this._tempPosition.y;this.position.set(t,i),this.prevPosition.set(t,i)},_end:function(t){t=void 0!==t?t:1,this.flags&=~t},_move:function(t,i){this._tempPosition.x=t,this._tempPosition.y=i;var n=this.domElement;n.style.width&&(this._tempPosition.x*=n.width/parseInt(n.style.width)),n.style.height&&(this._tempPosition.y*=n.height/parseInt(n.style.height))},_accessor:{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},dx:{get:function(){return this.deltaPosition.x},set:function(t){this.deltaPosition.x=t}},dy:{get:function(){return this.deltaPosition.y},set:function(t){this.deltaPosition.y=t}}}})}(),function(){phina.define("phina.input.Mouse",{superClass:"phina.input.Input",init:function(t){this.superInit(t),this.id=0;var i=this;this.domElement.addEventListener("mousedown",function(t){i._start(t.pointX,t.pointY,1<<t.flags)}),this.domElement.addEventListener("mouseup",function(t){i._end(1<<t.flags)}),this.domElement.addEventListener("mousemove",function(t){i._move(t.pointX,t.pointY)})},getButton:function(i){return"string"==typeof i&&(i=t[i]),0!=(this.now&i)},getButtonDown:function(i){return"string"==typeof i&&(i=t[i]),0!=(this.start&i)},getButtonUp:function(i){return"string"==typeof i&&(i=t[i]),0!=(this.end&i)},_static:{BUTTON_LEFT:1,BUTTON_MIDDLE:2,BUTTON_RIGHT:4}});var t={left:phina.input.Mouse.BUTTON_LEFT,middle:phina.input.Mouse.BUTTON_MIDDLE,right:phina.input.Mouse.BUTTON_RIGHT};phina.input.Mouse.prototype.getPointing=function(){return this.getButton("left")},phina.input.Mouse.prototype.getPointingStart=function(){return this.getButtonDown("left")},phina.input.Mouse.prototype.getPointingEnd=function(){return this.getButtonUp("left")}}(),function(){phina.define("phina.input.Touch",{superClass:"phina.input.Input",init:function(t){return this.superInit(t),void(this.id=null)},getTouch:function(){return 0!=this.touched},getTouchStart:function(){return 0!=this.start},getTouchEnd:function(){return 0!=this.end}}),phina.input.Touch.prototype.getPointing=phina.input.Touch.prototype.getTouch,phina.input.Touch.prototype.getPointingStart=phina.input.Touch.prototype.getTouchStart,phina.input.Touch.prototype.getPointingEnd=phina.input.Touch.prototype.getTouchEnd}(),function(){phina.define("phina.input.TouchList",{domElement:null,init:function(t,i){this.domElement=t,this.touches=[],this.stockes=[],i.times(function(){var i=phina.input.Touch(t);i.id=null,this.stockes.push(i)},this);var n=this;this.domElement.addEventListener("touchstart",function(t){Array.prototype.forEach.call(t.changedTouches,function(t){var i=n.getEmpty();i.id=t.identifier,i._start(t.pointX,t.pointY)})}),this.domElement.addEventListener("touchend",function(t){Array.prototype.forEach.call(t.changedTouches,function(t){var i=n.getTouch(t.identifier);i._end()})}),this.domElement.addEventListener("touchmove",function(t){Array.prototype.forEach.call(t.changedTouches,function(t){var i=n.getTouch(t.identifier);i._move(t.pointX,t.pointY)}),t.stop()})},getEmpty:function(){var t=this.stockes.pop();return this.touches.push(t),t},getTouch:function(t){return this.touches.filter(function(i){return i.id===t})[0]},removeTouch:function(t){var i=this.touches.indexOf(t);this.touches.splice(i,1),this.stockes.push(t)},update:function(){this.touches.forEach(function(t){null!==t.id&&(t.released?(t.released=!1,this.removeTouch(t)):(t.update(),0===t.flags&&(t.released=!0)))},this)}})}(),phina.namespace(function(){phina.define("phina.app.Updater",{init:function(t){this.app=t},update:function(t){this._updateElement(t)},_updateElement:function(t){var i=this.app;if(t.awake!==!1){t.update&&t.update(i),t.has("enterframe")&&t.flare("enterframe",{app:this.app});var n=t.children.length;if(t.children.length>0)for(var e=t.children.slice(),s=0;n>s;++s)this._updateElement(e[s])}},_checkPoint:function(t){this.app.pointers.forEach(function(i){null!==i.id&&this.__checkPoint(t,i)},this)},__checkPoint:function(t,i){if(t.interactive){var n=t._overFlags[i.id],e=t.hitTest2(i.x,i.y);t._overFlags[i.id]=e,!n&&e&&t.flare("pointover",{pointer:i}),n&&!e&&t.flare("pointout"),e&&i.getPointingStart()&&(t._touchFlags[i.id]=!0,t.flare("pointstart")),t._touchFlags[i.id]&&(t.flare("pointstay"),i._moveFlag&&t.flare("pointmove")),t._touchFlags[i.id]===!0&&i.getPointingEnd()&&(t._touchFlags[i.id]=!1,t.flare("pointend"),t._overFlags[i.id]&&(t._overFlags[i.id]=!1,t.flare("pointout")))}}})}),phina.namespace(function(){phina.define("phina.app.Interactive",{init:function(t){this.app=t,this._enable=!0},enable:function(){return this._enable=!0,this},disable:function(){return this._enable=!1,this},check:function(t){this._enable&&this._checkElement(t)},_checkElement:function(t){this.app;if(t.awake!==!1){this._checkPoint(t);var i=t.children.length;if(t.children.length>0)for(var n=t.children.slice(),e=0;i>e;++e)this._checkElement(n[e])}},_checkPoint:function(t){this.app.pointers.forEach(function(i){null!==i.id&&this.__checkPoint(t,i)},this)},__checkPoint:function(t,i){if(t.interactive){var n=t._overFlags[i.id],e=t.hitTest(i.x,i.y);t._overFlags[i.id]=e,!n&&e&&t.flare("pointover",{pointer:i}),n&&!e&&t.flare("pointout"),e&&i.getPointingStart()&&(t._touchFlags[i.id]=!0,t.flare("pointstart",{pointer:i})),t._touchFlags[i.id]&&(t.flare("pointstay"),i._moveFlag&&t.flare("pointmove")),t._touchFlags[i.id]===!0&&i.getPointingEnd()&&(t._touchFlags[i.id]=!1,t.flare("pointend"),t._overFlags[i.id]&&(t._overFlags[i.id]=!1,t.flare("pointout")))}}})}),phina.namespace(function(){phina.define("phina.app.BaseApp",{superClass:"phina.util.EventDispatcher",awake:null,fps:null,frame:null,init:function(t){this.superInit(),this._scenes=[phina.app.Scene()],this.updater=phina.app.Updater(this),this.interactive=phina.app.Interactive(this),this.awake=!0,this.ticker=phina.util.Ticker()},run:function(){var t=this;return this.ticker.tick(function(){t._loop()}),this.ticker.start(),this},replaceScene:function(t){return this.currentScene&&(this.flare("exit",{app:this}),this.currentScene.app=null),this.currentScene=t,this.currentScene.app=this,this.flare("enter",{app:this}),this},_loop:function(){this._update(),this._draw()},_update:function(){this.awake&&(this.update&&this.update(),this.updater.update(this.currentScene),this.interactive.check(this.currentScene))},_draw:function(){},_accessor:{currentScene:{get:function(){return this._scenes[0]},set:function(t){this._scenes[0]=t}}}})}),phina.namespace(function(){phina.define("phina.app.Element",{superClass:"phina.util.EventDispatcher",parent:null,children:null,init:function(){this.superInit(),this.children=[]},addChild:function(t){return t.parent&&t.remove(),t.parent=this,this.children.push(t),t.has("added")&&t.flare("added"),t},addChildTo:function(t){return t.addChild(this),this},addChildAt:function(t,i){return t.parent&&t.remove(),t.parent=this,this.children.splice(i,0,t),t.has("added")&&t.flare("added"),t},getChildAt:function(t){return this.children.at(t)},getChildByName:function(t){},getChildIndex:function(t){return this.children.indexOf(t)},getParent:function(){return this.parent},getRoot:function(){var t=this;for(t=this.parent;null!=t.parent;t=t.parent);return t},removeChild:function(t){var i=this.children.indexOf(t);return-1!==i&&(this.children.splice(i,1),t.has("removed")&&t.flare("removed")),this},remove:function(){return this.parent?(this.parent.removeChild(this),this.parent=null,this):void 0}})}),phina.namespace(function(){phina.define("phina.app.Object2D",{superClass:"phina.app.Element",position:null,rotation:0,scale:null,origin:null,init:function(){this.superInit(),this.position=phina.geom.Vector2(0,0),this.scale=phina.geom.Vector2(1,1),this.origin=phina.geom.Vector2(.5,.5),this._matrix=phina.geom.Matrix33().identity(),this._worldMatrix=phina.geom.Matrix33().identity(),this.interactive=!1,this._overFlags={},this._touchFlags={}},hitTest:function(t,i){var n=this.globalToLocal(phina.geom.Vector2(t,i)),e=-this.width*this.originX,s=+this.width*(1-this.originX),h=-this.height*this.originY,r=+this.height*(1-this.originY);return e<n.x&&n.x<s&&h<n.y&&n.y<r},globalToLocal:function(t){var i=this._worldMatrix.clone();i.invert();var n=i.multiplyVector2(t);return n},setInteractive:function(t){return this.interactive=t,this},_calcWorldMatrix:function(){if(this.parent){if(this.rotation!=this._cachedRotation){this._cachedRotation=this.rotation;var t=this.rotation*(Math.PI/180);this._sr=Math.sin(t),this._cr=Math.cos(t)}var i=this._matrix,n=this.parent._worldMatrix||phina.geom.Matrix33.IDENTITY,e=this._worldMatrix;i.m00=this._cr*this.scale.x,i.m01=-this._sr*this.scale.y,i.m10=this._sr*this.scale.x,i.m11=this._cr*this.scale.y,i.m02=this.position.x,i.m12=this.position.y;var s=i.m00,h=i.m01,r=i.m02,a=i.m10,o=i.m11,u=i.m12,c=n.m00,p=n.m01,l=n.m02,f=n.m10,d=n.m11,m=n.m12;return e.m00=c*s+p*a,e.m01=c*h+p*o,e.m02=c*r+p*u+l,e.m10=f*s+d*a,e.m11=f*h+d*o,e.m12=f*r+d*u+m,this}},_accessor:{x:{get:function(){return this.position.x},set:function(t){this.position.x=t}},y:{get:function(){return this.position.y},set:function(t){this.position.y=t}},originX:{get:function(){return this.origin.x},set:function(t){this.origin.x=t}},originY:{get:function(){return this.origin.y},set:function(t){this.origin.y=t}},scaleX:{get:function(){return this.scale.x},set:function(t){this.scale.x=t}},scaleY:{get:function(){return this.scale.y},set:function(t){this.scale.y=t}},width:{get:function(){return this._width},set:function(t){this._width=t}},height:{get:function(){return this._height},set:function(t){this._height=t}},radius:{get:function(){return void 0!==this._radius?this._radius:(this.width+this.height)/4},set:function(t){this._radius=t}},top:{get:function(){return this.y-this.height*this.originY},set:function(t){this.y=t+this.height*this.originY}},right:{get:function(){return this.x+this.width*(1-this.originX);

},set:function(t){this.x=t-this.width*(1-this.originX)}},bottom:{get:function(){return this.y+this.height*(1-this.originY)},set:function(t){this.y=t-this.height*(1-this.originY)}},left:{get:function(){return this.x-this.width*this.originX},set:function(t){this.x=t+this.width*this.originX}},centerX:{get:function(){return this.x+this.width/2-this.width*this.originX},set:function(t){}},centerY:{get:function(){return this.y+this.height/2-this.height*this.originY},set:function(t){}}}})}),phina.namespace(function(){phina.define("phina.app.Scene",{superClass:"phina.app.Element",init:function(){this.superInit()}})}),phina.namespace(function(){phina.define("phina.app.Tweener",{superClass:"phina.app.Element",init:function(t){this.superInit(),this.target=t,this._loop=!1,this._init()},_init:function(){this._tasks=[],this._index=0,this.playing=!0,this._update=this._updateTask},update:function(t){this._update(t)},to:function(t,i,n){return this._add({type:"tween",mode:"to",props:t,duration:i,easing:n}),this},from:function(t,i,n){return this._add({type:"tween",mode:"from",props:t,duration:i,easing:n}),this},wait:function(t){return this._add({type:"wait",data:{limit:t}}),this},call:function(t,i,n){return this._add({type:"call",data:{func:t,self:i||this,args:n}}),this},set:function(t,i){var n=null;return 2==arguments.length?(n={},n[t]=i):n=t,this._tasks.push({type:"set",data:{values:n}}),this},play:function(){return this.playing=!0,this},pause:function(){return this.playing=!1,this},stop:function(){return this.playing=!1,this.rewind(),this},rewind:function(){return this._update=this._updateTask,this._index=0,this.play(),this},yoyo:function(){return this._update=this._updateTask,this._index=0,this._tasks.each(function(t){"tween"===t.type,console.log(t)}),this.play(),this},setLoop:function(t){return this._loop=t,this},clear:function(){return this._init(),this},_add:function(t){this._tasks.push(t)},_updateTask:function(t){if(this.playing){var i=this._tasks[this._index];if(!i)return void(this._loop?this.rewind():this.playing=!1);++this._index,"tween"===i.type?(this._tween=phina.util.Tween(),"to"===i.mode?this._tween.to(this.target,i.props,i.duration,i.easing):this._tween.from(this.target,i.props,i.duration,i.easing),this._update=this._updateTween,this._update(t)):"wait"===i.type?(this._wait={time:0,limit:i.data.limit},this._update=this._updateWait,this._update(t)):"call"===i.type?(i.data.func.apply(i.data.self,i.data.args),this._update(t)):"set"===i.type&&(this.target.$extend(i.data.values),this._update(t))}},_updateTween:function(t){var i=this._tween,n=t.ticker.deltaTime;i.time>=i.duration?(delete this._tween,this._tween=null,this._update=this._updateTask):i.forward(n)},_updateWait:function(t){var i=this._wait,n=t.ticker.deltaTime;i.time+=n,i.time>=i.limit&&(delete this._wait,this._wait=null,this._update=this._updateTask)}})}),function(){phina.global.Event&&(Event.prototype.stop=function(){this.preventDefault(),this.stopPropagation()})}(),function(){phina.global.MouseEvent&&(MouseEvent.prototype.getter("pointX",function(){return this.clientX-this.target.getBoundingClientRect().left}),MouseEvent.prototype.getter("pointY",function(){return this.clientY-this.target.getBoundingClientRect().top}))}(),function(){phina.global.TouchEvent&&(TouchEvent.prototype.getter("pointX",function(){return this.touches[0].clientX-this.target.getBoundingClientRect().left}),TouchEvent.prototype.getter("pointY",function(){return this.touches[0].clientY-this.target.getBoundingClientRect().top}))}(),function(){phina.global.Touch&&(Touch.prototype.getter("pointX",function(){return this.clientX-this.target.getBoundingClientRect().left}),Touch.prototype.getter("pointY",function(){return this.clientY-this.target.getBoundingClientRect().top}))}(),phina.namespace(function(){phina.define("phina.graphics.Canvas",{domElement:null,canvas:null,context:null,init:function(t){this.canvas="string"==typeof t?document.querySelector(t):t||document.createElement("canvas"),this.domElement=this.canvas,this.context=this.canvas.getContext("2d"),this.context.lineCap="round",this.context.lineJoin="round"},setSize:function(t,i){return this.canvas.width=t,this.canvas.height=i,this},setSizeToScreen:function(){return this.canvas.style.position="fixed",this.canvas.style.margin="0px",this.canvas.style.padding="0px",this.canvas.style.left="0px",this.canvas.style.top="0px",this.setSize(window.innerWidth,window.innerHeight)},fitScreen:function(t){t=void 0===t?!0:t;var i=function(){var t=this.domElement,i=t.style;i.position="absolute",i.margin="auto",i.left="0px",i.top="0px",i.bottom="0px",i.right="0px";var n=t.width/window.innerWidth,e=t.height/window.innerHeight,s=t.height/t.width;n>e?(i.width=Math.floor(innerWidth)+"px",i.height=Math.floor(innerWidth*s)+"px"):(i.width=Math.floor(innerHeight/s)+"px",i.height=Math.floor(innerHeight)+"px")}.bind(this);i(),t&&window.addEventListener("resize",i,!1)},clear:function(t,i,n,e){return t=t||0,i=i||0,n=n||this.width,e=e||this.height,this.context.clearRect(t,i,n,e),this},clearColor:function(t,i,n,e,s){i=i||0,n=n||0,e=e||this.width,s=s||this.height;var h=this.context;return h.save(),h.setTransform(1,0,0,1,0,0),h.fillStyle=t,h.fillRect(i,n,e,s),h.restore(),this},beginPath:function(){return this.context.beginPath(),this},closePath:function(){return this.context.closePath(),this},moveTo:function(t,i){return this.context.moveTo(t,i),this},lineTo:function(t,i){return this.context.lineTo(t,i),this},fill:function(){return this.context.fill(),this},stroke:function(){return this.context.stroke(),this},clip:function(){return this.context.clip(),this},drawPoint:function(t,i){return this.strokeRect(t,i,1,1)},line:function(t,i,n,e){return this.moveTo(t,i).lineTo(n,e)},drawLine:function(t,i,n,e){return this.beginPath().line(t,i,n,e).stroke()},drawDashLine:function(t,i,n,e,s){var h=null;"string"==typeof s?h=s:(s=s||61680,h=s.toString(2)),h=h.padding(16,"1");var r=n-t,a=e-i,o=Math.sqrt(r*r+a*a);r/=o,a/=o;for(var u=t,c=i,p=0;o>p;++p)"1"==h[p%16]&&this.drawPoint(u,c),u+=r,c+=a;return this},drawArrow:function(t,i,n,e,s){var h=n-t,r=e-i,a=180*Math.atan2(r,h)/Math.PI;return this.drawLine(t,i,n,e),this.fillPolygon(n,e,s||5,3,a),this},lines:function(){this.moveTo(arguments[0],arguments[1]);for(var t=1,i=arguments.length/2;i>t;++t)this.lineTo(arguments[2*t],arguments[2*t+1]);return this},strokeLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.stroke(),this},fillLines:function(){return this.beginPath(),this.lines.apply(this,arguments),this.fill(),this},rect:function(t,i,n,e){return this.context.rect.apply(this.context,arguments),this},fillRect:function(){return this.context.fillRect.apply(this.context,arguments),this},strokeRect:function(){return this.context.strokeRect.apply(this.context,arguments),this},roundRect:function(t,i,n,e,s){var h=t+s,r=t+n-s,a=i+s,o=i+e-s;return this.context.arc(h,a,s,-Math.PI,.5*-Math.PI,!1),this.context.arc(r,a,s,.5*-Math.PI,0,!1),this.context.arc(r,o,s,0,.5*Math.PI,!1),this.context.arc(h,o,s,.5*Math.PI,Math.PI,!1),this.closePath(),this},fillRoundRect:function(t,i,n,e,s){return this.beginPath().roundRect(t,i,n,e,s).fill()},strokeRoundRect:function(t,i,n,e,s){return this.beginPath().roundRect(t,i,n,e,s).stroke()},circle:function(t,i,n){return this.context.arc(t,i,n,0,2*Math.PI,!1),this},fillCircle:function(t,i,n){var e=this.context;return e.beginPath(),e.arc(t,i,n,0,2*Math.PI,!1),e.closePath(),e.fill(),this},strokeCircle:function(t,i,n){var e=this.context;return e.beginPath(),e.arc(t,i,n,0,2*Math.PI,!1),e.closePath(),e.stroke(),this},polygon:function(t,i,n,e,s){var h=2*Math.PI/e,r=void 0!=s?s*Math.PI/180:-Math.PI/2;this.moveTo(t+Math.cos(r)*n,i+Math.sin(r)*n);for(var a=1;e>a;++a){var o=h*a+r;this.lineTo(t+Math.cos(o)*n,i+Math.sin(o)*n)}return this.closePath(),this},fillPolygon:function(t,i,n,e,s){return this.beginPath().polygon(t,i,n,e,s).fill()},strokePolygon:function(t,i,n,e,s){return this.beginPath().polygon(t,i,n,e,s).stroke()},star:function(t,i,n,e,s,h){var t=t||0,i=i||0,n=n||64,e=e||5,r=n*(s||.38),a=h?h*Math.PI/180:-Math.PI/2,o=2*Math.PI/e/2;this.moveTo(t+Math.cos(a)*n,i+Math.sin(a)*n);for(var u=1;2*e>u;++u){var c=o*u+a,p=u%2?r:n;this.lineTo(t+Math.cos(c)*p,i+Math.sin(c)*p)}return this.closePath(),this},fillStar:function(t,i,n,e,s,h){return this.beginPath().star(t,i,n,e,s,h).fill(),this},strokeStar:function(t,i,n,e,s,h){return this.beginPath().star(t,i,n,e,s,h).stroke(),this},setTransform:function(t,i,n,e,s,h){return this.context.setTransform(t,i,n,e,s,h),this},resetTransform:function(){return this.setTransform(1,0,0,1,0,0),this},transformCenter:function(){return this.context.setTransform(1,0,0,1,this.width/2,this.height/2),this},translate:function(t,i){return this.context.translate(t,i),this},rotate:function(t){return this.context.rotate(t),this},scale:function(t,i){return this.context.scale(t,i),this},_accessor:{width:{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t}},height:{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t}},fillStyle:{get:function(){return this.context.fillStyle},set:function(t){this.context.fillStyle=t}},strokeStyle:{get:function(){return this.context.strokeStyle},set:function(t){this.context.strokeStyle=t}}},_static:{dummyCanvas:function(){return phina.isNode()?null:document.createElement("canvas")}()}})}),phina.namespace(function(){phina.define("phina.display.CanvasElement",{superClass:"phina.app.Object2D",init:function(){this.superInit(),this.alpha=1,this._worldAlpha=1,this.width=64,this.height=64},_calcWorldAlpha:function(){if(!this.parent)return void(this._worldAlpha=this.alpha);var t=void 0!==this.parent._worldAlpha?this.parent._worldAlpha:1;this._worldAlpha=t*this.alpha}})}),phina.namespace(function(){phina.define("phina.display.Shape",{superClass:"phina.display.CanvasElement",init:function(t){this.superInit(),t=(t||{}).$safe({width:64,height:64,padding:8,backgroundColor:"#aaa"}),this.canvas=phina.graphics.Canvas(),this.style=phina.util.ChangeDispatcher(),this.style.register(t),this.style.onchange=function(){this._render()}.bind(this),this._render()},_render:function(){var t=this.style;this.canvas.width=t.width+2*t.padding,this.canvas.height=t.height+2*t.padding,this.canvas.clearColor(t.backgroundColor)},draw:function(t){var i=this.canvas.domElement,n=i.width,e=i.height;t.context.drawImage(i,0,0,n,e,-n*this.origin.x,-e*this.origin.y,n,e)}}),phina.define("phina.display.RectangleShape",{superClass:"phina.display.Shape",init:function(t){t=(t||{}).$safe({color:"blue",stroke:!0,strokeWidth:4,strokeColor:"#aaa",cornerRadius:0,backgroundColor:"transparent"}),this.superInit(t)},_render:function(){var t=this.style;this.canvas.width=t.width+2*t.padding,this.canvas.height=t.height+2*t.padding,this.canvas.clearColor(t.backgroundColor),this.canvas.transformCenter(),t.stroke&&(this.canvas.context.lineWidth=t.strokeWidth,this.canvas.strokeStyle=t.strokeColor,this.canvas.strokeRoundRect(-t.width/2,-t.height/2,t.width,t.height,t.cornerRadius)),this.canvas.context.fillStyle=t.color,this.canvas.fillRoundRect(-t.width/2,-t.height/2,t.width,t.height,t.cornerRadius)}}),phina.define("phina.display.CircleShape",{superClass:"phina.display.Shape",init:function(t){t=(t||{}).$safe({color:"red",radius:32,stroke:!0,strokeWidth:4,strokeColor:"#aaa",cornerRadius:0,backgroundColor:"transparent"}),this.superInit(t)},_render:function(){var t=this.style;this.canvas.width=2*t.radius+2*t.padding,this.canvas.height=2*t.radius+2*t.padding,this.canvas.clearColor(t.backgroundColor),this.canvas.transformCenter(),t.stroke&&(this.canvas.context.lineWidth=t.strokeWidth,this.canvas.strokeStyle=t.strokeColor,this.canvas.strokeCircle(0,0,t.radius)),this.canvas.context.fillStyle=t.color,this.canvas.fillCircle(0,0,t.radius)}})}),phina.namespace(function(){phina.define("phina.display.Sprite",{superClass:"phina.display.CanvasElement",init:function(t){this.superInit(),this.image=phina.asset.AssetManager.get("image",t),this.width=this.image.domElement.width,this.height=this.image.domElement.height},draw:function(t){var i=this.image.domElement;t.context.drawImage(i,0,0,i.width,i.height,-this.width*this.origin.x,-this.height*this.origin.y,this.width,this.height)}})}),phina.namespace(function(){phina.define("phina.display.Label",{superClass:"phina.display.Shape",init:function(t,i){this.text=t||"hoge\nfoo\nbar",i=(i||{}).$safe({color:"black",stroke:!0,strokeColor:"#222",strokeWidth:2,fontSize:32,fontWeight:"",fontFamily:"'HiraKakuProN-W3'",shadowBlur:0,shadowColor:"black",align:"center",baseline:"middle",backgroundColor:"transparent"}),this.superInit(i)},calcWidth:function(){var t=0,i=this.canvas;return this._lines.forEach(function(n){var e=i.context.measureText(n).width;e>t&&(t=e)},this),"center"!==this.style.align&&(t*=2),t},calcHeight:function(){var t=this.style.fontSize*this._lines.length;return"middle"!==this.style.baseline&&(t*=2),t},_render:function(){var t=this.style,i=this.canvas,n=i.context,e=this.style.fontSize,s="{fontWeight} {fontSize}px {fontFamily}".format(this.style),h=this.text.split("\n");i.context.font=s,i.width=this.calcWidth()+2*t.padding,i.height=this.calcHeight()+2*t.padding,i.clearColor(t.backgroundColor),i.transformCenter(),n.font=s,n.textAlign=this.style.align,n.textBaseline=this.style.baseline,n.fillStyle=this.style.color,n.strokeStyle=this.style.strokeColor,n.lineWidth=this.style.strokeWidth,n.lineJoin="round";var r=-Math.floor(h.length/2)*e;this.style.stroke&&(n.shadowBlur=0,h.forEach(function(t,i){n.strokeText(t,0,i*e+r)},this)),n.shadowBlur=this.style.shadowBlur,n.shadowColor=this.style.shadowColor,h.forEach(function(t,i){n.fillText(t,0,i*e+r)},this)},_accessor:{text:{get:function(){return this._text},set:function(t){this._text=t,this._lines=t.split("\n"),this.canvas&&this._render()}}}})}),phina.namespace(function(){phina.define("phina.display.CanvasScene",{superClass:"phina.app.Scene",init:function(t){this.superInit(),this.canvas=phina.graphics.Canvas(),this.canvas.setSize(t.width,t.height),this.renderer=phina.display.CanvasRenderer(this.canvas),this.interactive=!0,this._overFlags={},this._touchFlags={}},hitTest:function(){return!0},_update:function(){this.update&&this.update()},_render:function(){this.renderer.render(this)}})}),phina.namespace(function(){phina.define("phina.display.Layer",{superClass:"phina.display.CanvasElement",init:function(t){this.canvas=phina.graphics.Canvas()},draw:function(t){var i=this.currentScene.canvas;this.canvas.context.drawImage(i.domElement,0,0,i.width,i.height)}})}),phina.namespace(function(){phina.define("phina.display.ThreeLayer",{superClass:"phina.display.CanvasElement",scene:null,camera:null,light:null,renderer:null,init:function(t){this.superInit(),this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(75,t.width/t.height,1,1e4),this.camera.position.z=1e3,this.light=new THREE.DirectionalLight(16777215,1),this.light.position.set(1,1,1).normalize(),this.scene.add(this.light),this.renderer=new THREE.WebGLRenderer,this.renderer.setClearColor(15790320),this.renderer.setSize(t.width,t.height),this.on("enterframe",function(){this.renderer.render(this.scene,this.camera)})},draw:function(t){var i=this.renderer.domElement;t.context.drawImage(i,0,0,i.width,i.height)}})}),phina.namespace(function(){phina.define("phina.display.CanvasRenderer",{init:function(t){this.canvas=t,this._context=this.canvas.context},render:function(t){this.canvas.clear(),this._context.save(),this.renderObject(t),this._context.restore()},renderObject:function(t){if(t.visible!==!1){t._calcWorldMatrix&&t._calcWorldMatrix(),t._calcWorldAlpha&&t._calcWorldAlpha();var i=this.canvas.context;if(i.globalAlpha=t._worldAlpha,t._worldMatrix){var n=t._worldMatrix;i.setTransform(n.m00,n.m10,n.m01,n.m11,n.m02,n.m12)}if(t.clip){if(i.save(),t.clip(this.canvas),i.clip(),t.draw&&t.draw(this.canvas),t.children.length>0)for(var e=t.children.slice(),s=0,h=e.length;h>s;++s)this.renderObject(e[s]);i.restore()}else if(t.draw&&t.draw(this.canvas),t.children.length>0)for(var e=t.children.slice(),s=0,h=e.length;h>s;++s)this.renderObject(e[s])}}})}),phina.namespace(function(){phina.define("phina.display.DomApp",{superClass:"phina.app.BaseApp",domElement:null,init:function(t){this.superInit(),this.domElement=document.querySelector(t),this.mouse=phina.input.Mouse(this.domElement),this.touch=phina.input.Touch(this.domElement),this.touchList=phina.input.TouchList(this.domElement,4),this.pointer=this.touch,this.pointers=this.touchList.touches,this.domElement.addEventListener("touchstart",function(){this.pointer=this.touch,this.pointers=this.touchList.touches}.bind(this)),this.domElement.addEventListener("mousedown",function(){this.pointer=this.mouse,this.pointers=[this.mouse]}.bind(this)),this.domElement.addEventListener("touchstart",function(t){t.stop()}),this.domElement.addEventListener("touchmove",function(t){t.stop()})},update:function(){this.mouse.update(),this.touch.update(),this.touchList.update()}})}),phina.namespace(function(){phina.define("phina.display.CanvasApp",{superClass:"phina.display.DomApp",init:function(t){this.superInit(t.query),t.$safe({width:640,height:960,columns:12}),this.gridX=phina.util.Grid({width:t.width,columns:t.columns}),this.gridY=phina.util.Grid({width:t.height,columns:t.columns}),this.canvas=phina.graphics.Canvas(this.domElement),this.canvas.setSize(t.width,t.height),this.replaceScene(phina.display.CanvasScene({width:t.width,height:t.height})),this.fitScreen()},_draw:function(){this.canvas.clear(),this.currentScene._render();var t=this.currentScene.canvas;this.canvas.context.drawImage(t.domElement,0,0,t.width,t.height)},fitScreen:function(){this.canvas.fitScreen()}})}),phina.namespace(function(){phina.define("phina.effect.Wave",{superClass:"phina.display.CircleShape",init:function(t){this.superInit({color:"white",stroke:!1});var i=phina.app.Tweener(this).addChildTo(this);i.to({scaleX:2,scaleY:2,alpha:0},500).call(function(){this.remove()},this)}})}),phina.namespace(function(){phina.define("phina.ui.BaseButton",{superClass:"phina.display.CanvasElement",init:function(t){this.superInit(),t=(t||{}).$safe({width:200,height:80}),this.width=t.width,this.height=t.height,this.setInteractive(!0,"rect"),this.on("pointingend",function(){this.flare("push")})}})}),phina.namespace(function(){phina.define("phina.ui.Button",{superClass:"phina.ui.BaseButton",init:function(t){this.superInit(t),t=(t||{}).$safe({text:"Hello",color:"white",backgroundColor:"hsl(200, 80%, 60%)"}),this.setInteractive(!0,"rect"),this.on("pointend",function(){this.flare("push")}),this.bg=phina.display.RectangleShape({width:this.width,height:this.height,cornerRadius:8,color:t.backgroundColor,stroke:!1}).addChildTo(this),this.label=phina.display.Label(t.text,{color:t.color,stroke:!1}).addChildTo(this)}})}),phina.namespace(function(){phina.define("phina.ui.FlatButton",{superClass:"phina.display.CanvasElement",init:function(t){this.superInit(),t=t||{},t.$safe({width:200,height:80}),this.width=t.width,this.height=t.height,this.bg=phina.display.RectangleShape().addChildTo(this),this.bg.style.$extend({width:t.width,height:t.height}),this.label=phina.display.Label("hoge").addChildTo(this),this.setInteractive(!0,"rect")}})});